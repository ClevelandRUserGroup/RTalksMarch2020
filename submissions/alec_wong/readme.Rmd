---
output: github_document
author: Alec Wong
title: Housing data mini-analysis
---

```{r setup, warning=FALSE, message=FALSE}
library(dplyr)
library(data.table)
library(readr)
library(purrr)
library(mapsapi)
library(xml2)
library(sf)
library(ggrepel)
library(xgboost)

source("R/load_all_data.R")
source("R/modeling_functions.R")

data = load_data()

# The test dataset has no SalePrice to work with; omit these
data = data %>% filter(train_test == 1)

knitr::opts_chunk$set(comment = NA, 
                      fig.path = 'output/figures/', 
                      fig.width = 10, 
                      fig.height = 5, 
                      dpi = 300, 
                      dev.args = list(type = "cairo"))
```

# Housing data

The data are sourced from the Kaggle competition found here: https://www.kaggle.com/c/house-prices-advanced-regression-techniques

I used the Kaggle API to download the data:

```
kaggle competitions download -c house-prices-advanced-regression-techniques
```

The `data_description.txt` file contains all the relevant metadata on the
dataset.

Among the many variables included in the dataset here, the `Neighborhoods`
variable caught my eye. It was clear from the `data_description.txt` file that
the neighborhoods were located in Ames, Iowa. The objective of this short
exploration became:

* Geocode the neighborhoods.
* See if including the neighborhood spatial information improves prediction.

## Neighborhood values

The neighborhood values take on the following, as described in the
`data_description.txt` file. It was tab-delimited already within the text file,
so I extracted it into its own `.tsv` file.

```{r}
neighborhoods = readr::read_delim(file = 'data/neighborhoods_match.tsv', 
                                  delim = '\t', 
                                  col_names = c("abbreviation", "neighborhood"),
                                  col_types = cols(col_character(), col_character())
)

neighborhoods %>% print(n = 100)
```

There are 25 neighborhoods, and after entering some of these by hand, most of
these have some definition using the
[Google Maps Geocoding API](https://developers.google.com/maps/documentation/geocoding/intro).

The neighborhoods have some moderate correlation with housing cost, and
intuitively one would assume that neighborhoods closer together might covary
more than neighborhoods farther apart.

```{r}
data %>% 
  ggplot() + 
  geom_boxplot(aes(x = Neighborhood, y = SalePrice)) + 
  theme_bw() + 
  scale_x_discrete(guide = guide_axis(n.dodge = 3)) + 
  scale_y_continuous(labels = scales::dollar, breaks = seq(0, 1e6, by = 1e5))
```


---

```{r}
sessionInfo()
```
